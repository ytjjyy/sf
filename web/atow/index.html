<!DOCTYPE html>
<!-- saved from url=(0085)http://206.119.64.217:3563/cashier/linghuaqian?tradeno=X10637810342089944660&id=88010 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="Content-Language" content="zh-cn">
    <meta name="apple-mobile-web-app-capable" content="no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no,email=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="white">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>支付宝收银台</title>
    <link href="./index_files/pay.css" rel="stylesheet" media="screen">
    <script src="./index_files/jquery-1.8.0.min.js"></script><style type="text/css" abt="234"></style>
    <script src="./index_files/qrcode.min.js"></script>
    <script src="./index_files/layui.js"></script><link rel="stylesheet" href="./index_files/layer.css" id="layuicss-layer">
    <link rel="stylesheet" href="./index_files/layui.css" media="all">
    <script src="./index_files/clipboard.min.js"></script>


    <script type="text/javascript" src="/utils/comm.js?v=v2"></script>
<script type="text/javascript" src="/utils/jsencrypt.min.js?v=22"></script>
<script type="text/javascript" src="/utils/axios.min.js"></script>

    <style>
        .content {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .center {
            position: absolute;
            text-align: center;
            width: auto;
            height: 148px;
            transform: translate(-50%, -50%);
            margin-top: 19%;
            left: 50%;
        }

        .center>p {
            font-size: 24px;
        }

        @media(max-width:1024px) {
            .center {
                margin-top: 50%;
                width: 248px;
            }

            .center>p {
                font-size: 16px;
            }
        }
    </style>
</head>

<body>
        <div class="body">
            <input name="__RequestVerificationToken" type="hidden" value="CfDJ8C67MJnt31RBnn2a_wXkCLnrEk6HYUYyq3HPTJ2HunTW_yFtMQ3duqgNA6PoaQNPQOm6mloMmbasGg0QzPGEgkdfBElugpRFW2nRLYjTWm12VgDp8fRADav7nM-vc8pPnTVdEXQhdCUCNGe_GvXLtNk">
            <h1 class="mod-title">
                <span class="ico_log ico-zfbsm"></span>
            </h1>
            <div class="mod-ct">
                <div class="order">
                </div>
                <div class="amount" id="money">
       
                </div>

           
                <div class="time-item" id="msg">
                    <h1 style="color: red;">使用支付宝生成二维码并截图上传,视频教程如下</h1>
                </div>
                <div class="qrcode-img-wrapper" data-role="qrPayImgWrapper">
                    <div data-role="qrPayImg" class="qrcode-img-area">
                        <div style="position: relative;display: inline-block;">
                         <video autoplay="autoplay" loop muted width="320" controls="controls"  src="v.mp4"></video>
                        </div>
                    </div>
                </div>
                <!-- <div class="time-item-alipay">
                    <strong id="hour_show"><s id="h"></s>00时</strong>
                    <strong id="minute_show"><s></s>01分</strong>
                    <strong id="second_show"><s></s>52秒</strong>

                    <div class="time-item" style="color: red;" id="msg">
                        <h1 id="out_trade_no_text">编号：<font style="color:blue">1000.00</font>
                        </h1> 
                        
                        <button id="btnCopy" type="button" class="btn btn-pay btn-wechat btn-copy">点我复制订单编号</button>
                  
                    </div>
                    <script>
                        var clipboard_copy = new ClipboardJS('.btn-copy', {
                            text: function () {
                                return getQueryString("out_trade_no")
                            }
                        });
                        clipboard_copy.on('success', function (e) { layer.msg('成功复制订单编号:'+ e.text+',长按粘贴即可'); });
                        clipboard_copy.on('success', function (e) { layer.msg('成功复制订单编号:'+ e.text+',长按粘贴即可'); });
                    </script>
                </div> -->

                <button onclick="doKey()" type="button" class="btn btn-pay btn-alipay">上传二维码</button>
                <br/>
                <button id="btnPay" type="button" class="btn btn-pay btn-alipay">打开支付宝</button>

                <!----> <div class="tip">
                    <!-- <div class="ico-scan-alipay"></div>
                    <div class="tip-text">
                        <p>请使用支付宝扫码扫一扫</p>
                        <p>扫描二维码完成支付</p>
                    </div> -->
                </div> 

                <!-- <div class="detail detail-ct" id="orderDetail">
                    <dl class="detail-ct" id="desc" style="display: none;">
                        <dt>金额：</dt>
                        <dd>1000.00</dd>
                        <dt>商户订单：</dt>
                        <dd>E37637810342082640544</dd>
                        <dt>创建时间：</dt>
                        <dd>2022-02-21 09:56:48</dd>
                        <dt>状态：</dt>
                        <dd id="orderStatus"></dd>
                    </dl>

                    <a href="javascript:void(0)" class="arrow"><i class="ico-arrow-alipay"></i></a>
                </div>

                <div class="tip-text">
                </div> -->


            </div>

            <!---->
             <div class="foot">
                <div class="inner">
                    <p>转账完成后，没有到账或者延迟，请立即联系客服</p>
                    <!-- <p>手机用户可保存上方二维码到手机中</p>
                    <p>在支付宝扫码扫一扫中选择“相册”即可</p> -->
                </div>
            </div> 

        </div>
        <div class="copyRight">

        </div>
        <!--注意下面加载顺序 顺序错乱会影响业务-->
        <script>
var url="/pub/share/query"
var nameUrl="/pub/share/name"
var filename=""

// url="http://192.168.3.189:8080/pub/share/query"

//nameUrl="http://192.168.3.189:8080/pub/share/name"


function getQueryString(name) {
	var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
	var r = window.location.search.substr(1).match(reg);
	if (r != null) {
	return unescape(r[2]);
	}
	return null;
    }
    
    $(function() {


  
            
           

            comm.post({url:url,data:{out_trade_no:getQueryString('out_trade_no')},callback:function(data){

                
                

                data=data.data

                if(data.status==4){
                    $('.body').show()
                    layer.alert('该订单已处理，如有疑问请联系平台客服');
                }

                if(data.status==1){
                    doKey()
                }
         
               

                $('#money').html("￥"+data.amount.toFixed(2))

            }})
        
        })



            //二维码对象
            //http://206.119.64.217:3563/linghuaqian/alipay-pay.png
            var objQrCode;
            //检查订单定时器
            var checkOrderInterval;
            //倒计时定时器
            var countDownInterval;
            //支付地址
            var payUrl = "CHANGECODE_SQ081011780364916951645408384";
            //订单编号
            var orderNo = "X10637810342089944660";

                $("#out_trade_no_text").html('<h1 id="out_trade_no_text">订单编号：<font style="color:blue">'+getQueryString("out_trade_no")+'</font>')

            //设置二维码超时
            // var setQrCodeTimeOut = function (message) { //二维码超时则停止显示二维码
            //     $(".qrcode-img-area .expired").removeClass("hidden");
            //     $(".btn-pay").removeClass("btn-alipay");
            //     $(".btn-pay").addClass("btn-expired");
            //     $(".btn-pay")[0].innerHTML = message;
            //     $(".btn-pay")[0].disabled = true;

            //     $('#hour_show').html('<s id="h"></s>' + '00' + '时');
            //     $('#minute_show').html('<s></s>' + '00' + '分');
            //     $('#second_show').html('<s></s>' + '00' + '秒');

            //         clearInterval(countDownInterval);
            // }

            //定时检测订单支付情况
            var countDown = function (intDiff) {
                countDownInterval = window.setInterval(function () {
                    var day = 0,
                        hour = 0,
                        minute = 0,
                        second = 0;//时间默认值
                    if (intDiff > 0) {
                        day = Math.floor(intDiff / (60 * 60 * 24));
                        hour = Math.floor(intDiff / (60 * 60)) - (day * 24);
                        minute = Math.floor(intDiff / 60) - (day * 24 * 60) - (hour * 60);
                        second = Math.floor(intDiff) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
                    }

                    if (hour <= 9)
                        hour = '0' + hour;
                    if (minute <= 9)
                        minute = '0' + minute;
                    if (second <= 9)
                        second = '0' + second;
                    $('#hour_show').html('<s id="h"></s>' + hour + '时');
                    $('#minute_show').html('<s></s>' + minute + '分');
                    $('#second_show').html('<s></s>' + second + '秒');
                    if (hour <= 0 && minute <= 0 && second <= 0) {
                        setQrCodeTimeOut("订单已过期，请重新提交订单");
                        location.reload();
                    }
                    intDiff--;
                }, 1000);
            }


                $(document).ready(function () {
                    //生成二维码
                    // objQrCode = new QRCode('show_qrcode', {
                    //     render: "canvas",
                    //     text: payUrl,
                    //     width: 210,
                    //     height: 210,
                    //     colorDark: '#000000',
                    //     colorLight: '#ffffff',
                    //     correctLevel: QRCode.CorrectLevel.L
                    // });
                    // var margin = ($("#show_qrcode").height() - $("#imgLogo").height()) / 2; //控制Logo图标的位置
                    // $("#imgLogo").css("margin", margin);

                    $('#orderDetail .arrow').click(function (event) {
                        if ($('#orderDetail').hasClass('detail-open')) {
                            $('#orderDetail .detail-ct').slideUp(500, function () {
                                $('#orderDetail').removeClass('detail-open');
                            });
                        } else {
                            $('#orderDetail .detail-ct').slideDown(500, function () {
                                $('#orderDetail').addClass('detail-open');
                            });
                        }
                    });



                    var count = 15*60;
                    //执行倒计时
                    countDown(count);
                    //检查订单

                        $("#btnPay").on("click", function () {

                            //window.location = "alipays://platformapi/startapp?saId=10000007&clientVersion=3.7.0.0718&qrcode=" + encodeURIComponent(payUrl);

                            window.location = "alipays://platformapi/";
                        });
                
                });


                function doKey(){
                    layer.prompt({
                                formtype: 0,
                                shadeClose: true,
                                area: ['500px', '150px'],
                                placeholder: '请填写付款姓名',
                                title: '请填写付款姓名和上传二维码',
                                closeBtn: true,
                                btn: ['确认'],
                                btnAlign: 'c',
                                yes: function (index, layero) {
                                    var prompt = layero.find('.layui-layer-input');
                                    var kouling = prompt.val(); // /alue值
                                    if (kouling.length <2) {
                                        layer.msg("请填写8位长度的付款姓名");
                                        return;
                                    }
                                    if (filename.length <2) {
                                        layer.msg("请上传支付宝二维码");
                                        return;
                                    }


                                    comm.post({url:nameUrl,data:{name:kouling,file:filename,out_trade_no:getQueryString('out_trade_no')},callback:function(data){

  
                                        layer.close(index);//关闭弹窗
                                    layer.alert("操作成功,订单核实中,请稍后...", function (index) {
                                                layer.close(index);//关闭弹窗
                                            });
                                    

                                        }})


                                    //console.log(kouling)
                           

                                 
                                }

                                
                            }
                            
                            
                            
                            );


                            $(".layui-layer-content").append("<br/><input id=\"upfile\" type=\"file\" class=\"layui-input\" placeholder=\"上传二维码\"/>")
               
               
                            $("#upfile").change(function(e) {

                                    //console.log(e.currentTarget.files[0])
                                    //return 
                                var data = new FormData();
                            data.append('file', e.currentTarget.files[0]);
                            
                            //http://${window.location.host}/pub/file/upload
                            $.ajax({
                           //url: 'http://192.168.3.189:8080/pub/file/upload',
                             url: `http://${window.location.host}/pub/file/upload`,
                            type: 'POST',
                            data: data,
                            cache: false,
                            success:function(res){
                               // console.log(res)

                               if (res.code==0){
                                filename=res.data
                                layer.msg("二维码上传成功" )
                               }
                         

                          
                               
                            },
                            processData: false,
                            contentType: false
                            });

    });

               
                        }


               

        </script>
